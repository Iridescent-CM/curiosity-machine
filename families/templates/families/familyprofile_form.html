{% extends "profiles/profile_form.html" %}
{% load bootstrap4 %}
{% load pick_action %}
{% load staticfiles %}

{% block js %}
  {{ form.media|add:formset.media }}
{% endblock %}

{% block cards %}
  {% with SHOW_REQUIRED=True %}
  <form action="{% pick_action form edit="families:edit_profile" create="families:create_profile" %}" method="POST" novalidate>
    {% csrf_token %}

    <div class="card cm-info-card mb-5">
      <div class="card-header text-center p-3">
        <h4 class="card-title">Profile Info</h4>
        <small class="text-muted">* Please fill out all fields marked with an asterisk</small>
      </div>
      <div class="card-body">
        <div class="text-center avatar-settings">
          {% block avatar %}
            {% include "profiles/_avatar.html" with profile=request.user.profile width=80 height=80 crop='thumb' gravity='faces' classes='rounded-circle' %}
          {% endblock %}
          {% form_group form.image_url field_class="btn btn-primary" %}
        </div>
        {% email_form_group form.email email=email %}
        {% form_group form.phone %}
        {% form_group form.country %}
        {% comment %} location should probably be a compound widget to encapsulate the following sort of thing {% endcomment %}
        {% if form.country.value == "US" %}
        {% form_group form.state required=True %}
        {% else %}
        {% form_group form.state group_style="display:none;" required=True %}
        {% endif %}
        {% form_group form.city %}
        {% if form.instance and form.instance.pk %}
        <a class="btn btn-secondary" href="{% url "account_change_password"%}">Change password</a>
        {% endif %}
        {% if form.instance and form.instance.pk %}
        <input type="submit" class="btn btn-primary float-right" value="Save">
        {% endif %}
      </div>
    </div>

    {% if request.user.profile.members_confirmed %}
    {% include "families/_familyprofile_members.html" %}
    {% else %}
    {% include "families/_familyprofile_members_form.html" with formset=formset %}
    {% endif %}
  </form>
  {% endwith %}
{% endblock %}
