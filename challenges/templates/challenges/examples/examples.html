{% extends "curiositymachine/layout/base.html" %}
{% load resized %}

{% block body-id %}examples-page{% endblock %}
{% block content %}
  <div class="examples-top-panel">
    <div class="container">
      <h3><a href="{% url "challenges:preview_inspiration" challenge_id=challenge.id %}">{{ challenge.name }}</a></h3>
      <h1>Inspiration Gallery</h1>
    </div>
  </div>

  <div class="container">

    <!-- student who has started the design challenge but not posted in Reflect progress -->
    {% if progress and not progress.completed %}
    <div class="examples-page-alerts text-center p-a-md m-y-md">
      <h3>You are working on this design challenge!</h3>
      <p>Complete your project and post in Reflect. Then you can share your design here!</p>
      <a href="#" class="btn btn-primary">Keep Working</a>
    </div>
    {% endif %}

    <!-- student who has not started the design challenge -->
    {% if request.user.profile.is_student and not progress %}
    <div class="examples-page-alerts text-center p-a-md m-y-md">
      <h3>Want to {{ challenge.name }}?</h3>
      <a href="#" class="btn btn-primary">Start Building</a>
    </div>
    {% endif %}

    <!-- student who has started the challenge AND posted in Reflect progress -->
    {% if progress.completed and not user_has_example %}
    <div class="examples-page-alerts text-center p-a-md m-y-md">
      <h3>Add your project!</h3>
      <p>Want to share your design? Choose a photo from your project and add it to the Inspiration Gallery.</p>
      <a href="#" class="btn btn-purple" data-toggle="modal" data-target="#choose-photo"><i class="icon-camera" {% if not request.user.profile.is_student %}disabled="disabled"{% endif %}></i>Choose a Photo</a>


      <!-- A Pending Example submission -->
      <!--
      <div class="alert alert-info m-t-md" role="alert">
        <strong>Thanks for submitting your project!</strong> Once your photo has been approved, it will show up in the gallery for everyone to see.
      </div>
      -->


      <div class="modal fade" id="choose-photo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              <h3>Choose a Photo</h3>
            </div>
            <form method="POST" action="{% url "challenges:add_example" challenge_id=challenge.id %}">
              <div class="modal-body text-center">
                <p>Your images from {{ challenge.name }}</p>
                <div class="row">
                  {% csrf_token %}
                  {% for image in progress.get_student_images %}
                  <div class="col-md-6">
                    <input type="radio" name="example" id="example-{{image.id}}" value="{{image.id}}">
                    <label for="example-{{image.id}}">
                      <img src="{{ image.url }}" alt="">
                    </label>
                  </div>
                  {% empty %}
                    <h3>You have not added any photos to this challenge!</h3>
                  {% endfor %}
                </div>
              </div>
              <div class="modal-footer">
                <a href="#" data-dismiss="modal" aria-label="Close">Cancel</a>
                <input type="submit" class="btn btn-primary">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <div class="row text-center">
      {% include "curiositymachine/_pagination_controls.html" with curr_page=examples anchor="examples" %}
    </div>

    <div class="row m-y">

      {% for example in examples %}
      <div class="col-lg-3 col-sm-6">
        <div class="card">
          <a href="#" data-toggle="modal" data-target="#{{ example.progress.student.username }}">
            <img class="card-img-top action-img" src="{% resized example.image.url width=330 height=200 crop='fill' %}" alt="{{ example.progress.student.username }}'s {{ challenge.name }}">
            <div class="pending"><em>Pending Approval!</em></div>
          </a>
          <div class="card-block text-center">
            <p class="card-title">{{ example.progress.student.username }}</p>
          </div>
        </div>
      </div>

      <div class="modal fade" id="{{ example.progress.student.username }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              <h3>{{ example.progress.student.username }}'s {{ challenge.name }}</h3>
            </div>
            <div class="modal-body text-center">
              <img src="{% resized example.image.url crop='fill' %}" alt="{{ example.progress.student.username }}'s {{ challenge.name }}">
            </div>
          </div>
        </div>
      </div>
      {% empty %}

      <!-- anonymous user -->
      {% if not request.user.is_authenticated %}
      <div class="examples-page-alerts text-center p-a-md m-y-md">
        <h3>There aren't any examples here!</h3>
        <p>Be the first to share your design! Create a student account and build this design challenge to submit your project.</p>
        <a href="{% url "profiles:join" %}" class="btn btn-primary">Create a Student Account</a>
        <a href="{% url "login" %}" class="btn btn-green">Log In</a>
      </div>

      <!-- student who has not started this challenge -->
      {% elif request.user.profile.is_student %}
        {% if not progress %}
        <div class="examples-page-alerts text-center p-a-md m-y-md">
          <h3>There aren't any examples here!</h3>
          <p>Be the first to share your design! Build this design challenge to submit your project.</p>
          <a href="#" class="btn btn-primary">Start Building</a>
        </div>
        {% endif %}

        <!-- student who has started this challenge -->
        {% if progress and not progress.completed %}
        <div class="examples-page-alerts text-center p-a-md m-y-md">
          <h3>There aren't any examples here!</h3>
          <p>Be the first to share your design! Finish your project and come back to submit it.</p>
          <a href="#" class="btn btn-primary">Keep Building</a>
        </div>
        {% endif %}

        <!-- student who has started challenge & posted in Reflect progress -->
        {% if progress.completed %}
        <div class="text-center p-a-md m-y-md">
          <h3>There aren't any examples here!</h3>
          <p>add yours above!</p>
        </div>
        {% endif %}

      <!-- mentors, educators & parents -->
      {% else %}
      <div class="examples-page-alerts text-center p-a-md m-y-md">
        <h3>There aren't any examples here!</h3>
        <p>When a student builds a project, they can add their design to this page. Encourage them to be creative!</p>
        <a href="#">{{ challenge.name }}</a>
      </div>
      {% endif %}
      {% endfor %}

    </div>

    <div class="row text-center">
      {% include "curiositymachine/_pagination_controls.html" with curr_page=examples anchor="examples" %}
    </div>

  </div>

{% endblock %}
