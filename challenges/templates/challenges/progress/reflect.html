{% extends 'base.html' %}
{% load staticfiles %}
{% load resized %}

{% block js %}
  <script src="{% static "js/challenges.js" %}"></script>
{% endblock %}

{% block content %}
  <h1>{{ challenge.name }} <small>By {{progress.student.username}}</small></h1>
  {% if challenge.draft %}
    <h2><small>We're improving this challenge. You can keep working on it, but keep an eye out for changes.</small></h2>
  {% endif %}
  {% include "challenges/progress/_nav.html" with stage="reflect" %}
  <div class="challenge-content">
    {% if not request.user.profile.is_mentor %}
      <header class="challenge-header">
        <h1>Document your design process</h1>
        <p>{{ challenge.reflect_subheader }}</p>
      </header>
    {% endif %}

    {% if request.user.profile.is_student and progress.completed %}
      <div class="panel green congratulations-panel">
        <div class="panel-body text-center">
          <h2>Congratulations!</h2>
          <p>
            You just completed a design challenge! Now you can post a picture of your project to the Inspiration Gallery
            to share with the community.
          </p>
          <a href="{% url "challenges:examples" challenge_id=challenge.id %}" class="btn btn-link" style="color: white;">Go to the Inspiration Gallery</a>
        </div>
      </div>
    {% endif %}

    <div class="row">
      {% if request.user.profile.is_mentor %}
        {% include "_mentor_panel.html" %}
      {% else %}
        <div class="col-md-5">
          <div class="panel blue">
            <div class="panel-body">
              <p>You've made great progress on this challenge. I think you are ready to move on to the next step.</p>
              <p><strong>Reflect on your design.</strong></p>
            </div>
          </div>
        </div><!-- /column 1 -->
      {% endif %}

      <div class="col-md-1">
        {% include "_avatar.html" with profile=progress.student.profile width=60 height=80 crop='fit' %}
      </div>

      <div class="col-md-6">
        {% if request.user.profile.is_mentor %}
          <h1>{{progress.student.username}}'s progress</h1>
        {% else %}
          <div class="panel panel-bubble teal right reflect-box">
            <div class="panel-body">
              <h1>Reflect</h1>
              <p>You've finished your challenge. Upload a key photo and describe what makes your challenge unique.</p>

                <ul class="challenge-reflect-questions" style="display: none;">
                  {% for question in challenge.reflect_questions.all %}
                    <li>{{ question }}</li>
                  {% endfor %}
                </ul>

                <div class="reflect-question">
                  <h3 class="question"></h3>
                  <p class="refresh" title="answer a different question">
                    <span class="glyphicon glyphicon-refresh"></span> Try another question.
                  </p>
                </div>

                {% if request.user.profile.is_student %}
                  {% include "_comment_action_list.html" %}
                {% else %}
                  {% include "_comment_action_list.html" with disable=True %}
                {% endif %}
            </div>
          </div>
          {% include "_challenge_reflect_images_modal.html" %}
        {% endif %}

        {% for comment in comments %}
          {% include "_comment.html" %}
        {% endfor %}
      </div><!-- /col 2 -->

    </div><!-- row -->

    {% include "_guide.html" %}
    {% url "challenges:comments:comments" challenge_id=challenge.id username=progress.student.username stage='reflect' as comment_url %}
    {% include "_comment_form.html" with stage="reflect" format="video" url=comment_url %}
    {% include "_comment_form.html" with stage="reflect" format="picture" url=comment_url %}
    {% include "_comment_form.html" with stage="reflect" format="text" url=comment_url %}

  </div><!-- content -->

{% endblock %}
