{% extends 'base.html' %}
{% load staticfiles %}
{% load resized %}
{% load widget_tweaks %}

{% block js %}
  <script src="{% static "js/challenges.js" %}"></script>
  {{ comment_form.media }}
{% endblock %}

{% block content %}
  {% url "challenges:comments:comments" challenge_id=challenge.id username=progress.student.username stage='build' as comment_url %}

  <h1>{{ challenge.name }} <small>By {{progress.student.username}}</small></h1>
  {% if challenge.draft %}
    <h2><small>We're improving this challenge. You can keep working on it, but keep an eye out for changes.</small></h2>
  {% endif %}
  {% include "challenges/progress/_nav.html" with stage="build" %}
  <div class="challenge-content">
    {% if not request.user.profile.is_mentor %}
      <header class="challenge-header">
        <h1>Document your design process</h1>
        <p>{{ challenge.build_subheader }}</p>
      </header>
    {% endif %}
    <div class="row">
      {% if request.user.profile.is_mentor %}
        {% include "_mentor_panel.html" with comment_url=comment_url %}
      {% else %}
        <div class="col-md-5">
          <div class="panel blue">
            <div class="panel-body">
              {{challenge.build_call_to_action}}
            </div>
          </div>
        </div><!-- /column 1 -->
      {% endif %}

      <div class="col-md-1">
        <div class="avatar-container">
          {% include "_avatar.html" with profile=progress.student.profile width=50 height=50 crop='fill' %}
        </div>
      </div>

      <div class="col-md-6">
        {% if request.user.profile.is_mentor %}
          <h3>{{progress.student.username}}'s progress</h3>
        {% else %}
          <div class="panel panel-bubble right edp-comments">
            <div class="panel-body">
              <h3>What step are you on?</h3>
              {% if request.user.profile.is_student %}
                <form method="POST" action="{{ comment_url }}">
                  {% csrf_token %}
                  <div class="form-group">
                    <ul class="switch stage-switch">
                      <li>
                        <input type="radio" name="stepSelector" id="buildSelector" value="build" checked>
                        <label for="buildSelector">Building</label>
                      </li>
                      <li>
                        <input type="radio" name="stepSelector" id="testSelector" value="test">
                        <label for="testSelector">Testing</label>
                      </li>
                    </ul>
                  </div>
                  {{ comment_form.text|attr:"placeholder:Tell us about your design here. You can also add a photo or video below." }}
                  {{ comment_form.visual_media }}
                  <input type="submit" class="btn btn-primary pull-right" data-debounce="true" />
                </form>
              {% else %}
                <form>
                  <div class="form-group">
                    <ul class="switch stage-switch">
                      <li>
                        <input type="radio" name="stepSelector" id="buildSelector" value="build" checked>
                        <label for="buildSelector">Building?</label>
                      </li>
                      <li>
                        <input type="radio" name="stepSelector" id="testSelector" value="test">
                        <label for="testSelector">Testing?</label>
                      </li>
                    </ul>
                  </div>
                  {{ comment_form.text|attr:"disabled:disabled" }}
                  {{ comment_form.visual_media|attr:"disabled:disabled" }}
                  <input type="submit" disabled="disabled" class="btn btn-primary pull-right" />
                </form>
              {% endif %}

            </div>
          </div>
        {% endif %}

        {% for comment in comments %}
          {% include "_comment.html" %}
        {% endfor %}
      </div><!-- /col 2 -->

    </div><!-- row -->

    {% include "_guide.html" %}

  </div><!-- content -->

{% endblock %}
