{% load cmtemplatetags %}
{% load array %}

{% if comment.user.profile.is_mentor %}
  <span class="mentor-comment">MENTOR MESSAGE</span>
  <span class="comment-date">{{ comment.created|timesince }}</span>
  <div class="mentor-info comment">
    {% include "_avatar.html" with profile=comment.user.profile width=50 height=50 crop='fit' %}
    <p>{{comment.user.username}}<br><strong>Mentor</strong></p>
  </div>
  <div class="panel panel-bubble blue comment">
    <div class="panel-body">
      {% include "_comment_content.html" %}
    </div>
  </div>
{% else %}
  <span class="comment-date">{{ comment.created|timesince }}</span>
  <div class="panel panel-comment comment">
    <div class="panel-heading">
       <h3 class="panel-title">
        {{ comment.get_stage_display }}  
        </h3>        
    </div>
    
    {% if not comment.is_featured_as_example %}
      <form name="deletecomment" class="ajax-and-refresh-form" action="{% url "challenges:comments:delete_comment" challenge_id=challenge.id username=progress.student.username comment_id=comment.id stage=stage.name %}" method="DELETE">
      {% csrf_token %}
      <button type="submit" value="" class="btn btn-comment-heading pull-right glyphicon glyphicon-trash" onclick="return confirm('Are you sure you want to delete this comment?');"></button> 
      </form>
      
      {% if comment.text %} 
        <button class="btn pull-right btn-comment-heading margin-r-55 glyphicon glyphicon-edit" data-toggle="modal" data-target="#edit_text_modal{{comment.id}}">
        </button>
        {% url "challenges:comments:edit_comment" challenge_id=challenge.id username=progress.student.username comment_id=comment.id stage=stage.name as url %}
        {% include "_edit_text_modal.html" with url=url id=comment.id comment_form=comment_forms|element_by_index:comment.id %}
      {% endif %}
    {% endif %}
       
   
    <div class="panel-body paper">
      {% include "_comment_content.html" %}
      {% if request.user.profile.is_mentor and comment.get_stage_display == 'reflect'%}{% if comment.image or comment.video %}
      {% if comment.is_featured_as_example %}
        <form name="unfeature" class="ajax-and-refresh-form" action="{% url "challenges:comments:feature_as_example" challenge_id=challenge.id username=progress.student.username stage='build' comment_id=comment.id %}" method="DELETE">
          {% csrf_token %}
          <input type="submit" value="Unfeature {% if comment.video %}video{% else %}image{% endif %}" class="btn pull-right btn-xs">
        </form>
      {% else %}
        {# display a button so that the mentor can feature this comment's media on the inspiration page #}
        <form name="feature_as_example" class="ajax-and-refresh-form" action="{% url "challenges:comments:feature_as_example" challenge_id=challenge.id username=progress.student.username stage='build' comment_id=comment.id %}" method="POST">
          {% csrf_token %}
          <input type="submit" value="Feature {% if comment.video %}video{% else %}image{% endif %} as example" class="btn pull-right btn-xs btn-primary">
        </form>
      {% endif %}
    {% endif %}{% endif %}
    </div>
  </div>
{% endif %}
