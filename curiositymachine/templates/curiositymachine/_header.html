{% load resized %}
{% load staticfiles %}

<div class="modal fade" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="login-modal-label" aria-hidden="true">
  <button type="button" class="close modal-close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">&times;</span>
    <span class="sr-only">Close</span>
  </button>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-center" id="login-modal-label">Log In</h2>
      </div>
      <form method="post" action="{% url 'login' %}">
        <div class="modal-body">
          <div class="row">
            {% csrf_token %}
            <div class="col-xs-12">
              {{ login_form.login.label_tag }}
            </div>
            <div class="col-xs-12">
              {{ login_form.login }}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12">
              {{ login_form.password.label_tag }}
            </div>
            <div class="col-xs-12">
              {{ login_form.password }}
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <a href="{% url "account_reset_password" %}">Forgot your password?</a>
          <a class="btn btn-link" data-dismiss="modal" aria-hidden="true">Cancel</a>
          <input type="submit" value="Log In" class="btn btn-primary" />
          <input type="hidden" name="next" value="{{ next|default:'/' }}" />
        </div>
      </form>
    </div>
  </div>
</div>

<header class="navbar navbar-light">
  <div class="container">

    <div class="clearfix">
      <a class="navbar-toggler float-xs-right hidden-lg-up" data-target="#main-nav" data-toggle="collapse">Menu</a>
      <a class="navbar-brand a-borderless hidden-lg-up" href="/">
        <img src="{% static 'images/cm-logo-small.svg' %}" alt="curiosity machine" class="logo-sm">
      </a>
    </div>

    <div id="main-nav" class="collapse navbar-toggleable-md">
      <nav>
        <a href="/" class="navbar-brand a-borderless hidden-md-down">
          <img src="{% static 'images/cm-logo.svg' %}" alt="curiosity machine" class="logo">
        </a>

        <ul class="nav navbar-nav">

          {% if request.user.is_authenticated %}

          <li class="nav-item hidden-lg-up">
            <ul class="list-group nav-profile">
              <li class="list-group-item active">
                <div class="avatar text-center">{% include "_avatar.html" with profile=request.user.profile width=40 height=40 crop='thumb' gravity='faces' %}</div>
                <span class="profile-name">{{ user.username }}</span>
              </li>
              <li class="list-group-item">
                <a href="{% url 'profiles:home' %}">My Dashboard</a>
              </li>
              <li class="list-group-item">
                <a href="{% url 'profiles:edit_profile' %}">Account Settings</a>
              </li>
              {% if request.user.is_staff %}
                <li class="list-group-item">
                  <a href="{% url "admin:index" %}">View Admin</a>
                </li>
                <li class="list-group-item">
                  <a href="{% url "admin:challenges_example_changelist" %}">
                    Pending Examples
                    {% if staff_alerts.pending_examples %}
                      <span class="tag tag-pill tag-default">{{staff_alerts.pending_examples}}</span>
                    {% endif %}
                  </a>
                </li>
              {% endif %}
              <li class="list-group-item">
                <form action="{% url 'logout' %}?next=/" method="POST">
                  {% csrf_token %}
                  <input type=submit class="btn-link" value="Log Out"/>
                </form>
              </li>
            </ul>
          </li>

          {% endif %}

          <li class="nav-item">
            <a class="nav-link nav-aichallenge" href="{% url "aichallenge" %}">AI Family Challenge</a>
          </li>

          <li class="nav-item">
            <a class="nav-link nav-challenges" href="{% url "challenges:challenges" %}">All Challenges</a>
          </li>

          <li class="nav-item">
            <a class="nav-link nav-about" href="{% url "about" %}">About Us</a>
          </li>

          {% if request.user.is_authenticated %}
          <li class="nav-item dropdown nav-profile hidden-md-down">
            <a class="nav-link dropdown-toggle" id="usermenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="profile-name">{{ user.username }}</span>
              <span class="avatar">{% include "_avatar.html" with profile=request.user.profile width=40 height=40 crop='thumb' gravity='faces' %}</span>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="usermenu">
              <a class="dropdown-item" href="{% url 'profiles:home' %}">My Dashboard</a>
              <a class="dropdown-item" href="{% url 'profiles:edit_profile' %}">Account Settings</a>
              {% if request.user.is_staff %}
                <a class="dropdown-item" href="{% url "admin:index" %}">View Admin</a>
                <a class="dropdown-item" href="{% url "admin:challenges_example_changelist" %}">
                  Pending Examples
                  {% if staff_alerts.pending_examples %}
                    <span class="tag tag-pill tag-default">{{staff_alerts.pending_examples}}</span>
                  {% endif %}
                </a>
              {% endif %}
              <form action="{% url 'logout' %}?next=/" method="POST">
                {% csrf_token %}
                <input type=submit class="dropdown-item" value="Log Out"/>
              </form>
            </div>
          </li>

          {% else %}

          <li class="nav-item">
            <a href="#" class="nav-link nav-login" data-toggle="modal" data-target="#login-modal">Log In</a>
          </li>

          <li class="nav-item">
            <a class="btn btn-primary hidden-md-down" href="{% url "account_signup" %}">Sign Up</a>
            <a class="nav-link nav-join hidden-lg-up" href="{% url "account_signup" %}">Sign Up</a>
          </li>

          {% endif %}

        </ul>
      </nav>
    </div>
  </div>
</header>
